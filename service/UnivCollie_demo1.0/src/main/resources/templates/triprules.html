<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!--><html xmlns:th="http://www.thymeleaf.org">
<html class="no-js" lang="">
	<!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Ela Admin - HTML5 Admin Template</title>
		<meta name="description" content="Ela Admin - HTML5 Admin Template">
		<meta name="viewport" content="width=device-width, initial-scale=1">


		<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
		<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
		<link rel="stylesheet" th:href="@{/css/themify-icons.css}">
		<link rel="stylesheet" th:href="@{/css/pe-icon-7-filled.css}">
		<link rel="stylesheet" th:href="@{/css/flag-icon.min.css}">
		<link rel="stylesheet" th:href="@{/css/style.css}">


		<link rel="stylesheet" type="text/css" th:href="@{/css/jquery.dataTables.min.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{/css/buttons.dataTables.min.css}" />
		<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
		
		

		
		

		<style>
			#weatherWidget .currentDesc {
        color: #ffffff!important;
    }
        .traffic-chart {
            min-height: 335px;
        }

		.sosnumber{
			color: white;
			margin-left: 5%;
			background-color: #d9534f;
			border-radius:50px;
		}

        #flotPie1  {
            height: 150px;
        }
        #flotPie1 td {
            padding:3px;
        }
        #flotPie1 table {
            top: 20px!important;
            right: -10px!important;
        }
        .chart-container {
            display: table;
            min-width: 270px ;
            text-align: left;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        #flotLine5  {
             height: 105px;
        }

        #flotBarChart {
            height: 150px;
        }
        #cellPaiChart{
            height: 160px;
        }
		#container {
			width:100%;
			height: 600px;
		}
		</style>
	</head>

	<body>
		<!-- Left Panel -->

		<aside id="left-panel" class="left-panel">
			<nav class="navbar navbar-expand-sm navbar-default">
				<div id="main-menu" class="main-menu collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<li >
							<a href="/admin/index"><i class="menu-icon fa fa-laptop"></i>数据视图</a>
						</li>
						<li>
							<a href="/admin/sosinfor"><i class="menu-icon fa fa-laptop"></i>紧急求助<span class="sosnumber">&nbsp;0&nbsp;</span></a>
						</li>
						<li class="menu-title">用户管理</li><!-- /.menu-title -->
						<li >
							<a href="/admin/teachermanager"> <i class="menu-icon fa fa-th"></i>教师管理员</a>

						</li>
						<li class="">
							<a href="/admin/studentmanager"><i class="menu-icon fa fa-th"></i>学生安全员</a>
						</li>
						<li class="">
							<a href="/admin/student"> <i class="menu-icon fa fa-th"></i>普通学生</a>
						</li>

						<li class="menu-title">系统设置</li><!-- /.menu-title -->

						<li class="active">
							<a href="/admin/triprules"> <i class="menu-icon fa fa-cogs"></i>出行规则</a>
						</li>
						<li>
							<a href="/admin/sospunch"> <i class="menu-icon fa fa-cogs"></i>打卡应急</a>
						</li>
						
						<li class="menu-title">账户操作</li><!-- /.menu-title -->

						<li class="menu-item-has-children dropdown">
							<a href="#"></i>安全退出</a>
						</li>
					</ul>
				</div><!-- /.navbar-collapse -->
			</nav>
		</aside>
		<!-- /#left-panel -->
		<!-- Right Panel -->
		<div id="right-panel" class="right-panel">
			<!-- Header-->
			<header id="header" class="header">
				<div class="top-left">
					<div class="navbar-header">
						<a class="navbar-brand" href="./"><img th:src="@{/images/logo.png}" alt="Logo"></a>
						<a class="navbar-brand hidden" href="./"><img th:src="@{/images/logo2.png}" alt="Logo"></a>
						<a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
					</div>
				</div>
				
			</header>
			<!-- /#header -->
			<!-- Content -->
			<div class="content">
				<div class="animated fadeIn">
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<strong class="card-title">修改电子围栏规则</strong>
								</div>
								<div class="card-body">
									<form action="/admin/updataEnclosure" method="get" class="form-inline" role="form">
										<div class="form-group">
											<label>中心坐标经度-</label>
											<input id="longitude" type="text" class="form-control" name="longitude" placeholder="" readonly>
										</div>
										<div class="form-group">
											<label>中心坐标纬度-</label>
											<input id="latitude" type="text" class="form-control" name="latitude" placeholder="" readonly>
										</div>
										<div class="form-group">
											<label>围栏大小</label>
											<input id="radius" type="text" class="form-control" name="radius" placeholder="" readonly>
										</div>

										<button type="submit" class="btn btn-warning">更新围栏</button>
									</form>
									<!--<button class="btn btn-warning" onclick="circleEditor.open()">开始编辑</button>-->
									<!--<button class="btn btn-warning" onclick="circleEditor.close()">结束编辑</button>-->
								</div>
							</div>
						</div>
					</div><!-- .animated -->


				<div class="row">
					<div class="col-md-12">
						<div class="card">
							<div class="card-header">
								<strong class="card-title">范围展示</strong>
							</div>
							<div class="card-body">

								<div id="container"></div>

							</div>
						</div>




					</div>
				</div><!-- .animated -->
			</div>
			</div>


		</div>

		
	</body>

	<script type="text/javascript" th:src="@{/js/jquery-2.1.4.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/dataTables.buttons.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/buttons.flash.min.js}"></script>
	<script type="text/javascript" th:src="@{/js/buttons.html5.min.js}"></script>

	<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.14&key=1d835c78f580eb9e072b4ebb257b7980&diu=869033024848468&plugin=AMap.CircleEditor"></script>
	<script>

		$(document).ready(begin());
		function begin() {
			setInterval(getSosNumber,3000);
			getlocation();
			// setInterval(reloadTable,3000);
		}

		function getSosNumber() {
			$.get("/data/sosnumber", function(data,status) {
				$(".sosnumber").html("&nbsp" +data+ "&nbsp;");
			});
		}

		function creatMap(center,radius) {

			var map = new AMap.Map("container", {
				center: center,
				zoom: 14
			});
			var circle = new AMap.Circle({
				center: center,
				radius: radius, //半径
				borderWeight: 3,
				strokeColor: "#FF33FF",
				strokeOpacity: 1,
				strokeWeight: 6,
				strokeOpacity: 0.2,
				fillOpacity: 0.4,
				strokeStyle: 'dashed',
				strokeDasharray: [10, 10],
				// 线样式还支持 'dashed'
				fillColor: '#1791fc',
				zIndex: 50,
			})

			circle.setMap(map)
			// 缩放地图到合适的视野级别
			map.setFitView([ circle ])
			var circleEditor = new AMap.CircleEditor(map, circle)
			circleEditor.open()
			circleEditor.on('move', function(event) {
				document.getElementById("longitude").value=circle.getCenter().getLng();
				document.getElementById("latitude").value=circle.getCenter().getLat();
				document.getElementById("radius").value=circle.getRadius();
			})

			circleEditor.on('adjust', function(event) {
				document.getElementById("radius").value=circle.getRadius();
			})

			circleEditor.on('end', function(event) {

				// event.target 即为编辑后的圆形对象
			})
		}



		function getlocation() {
			$.get("/data/getlocation", function(data,status) {
				var center=[102.847639, 24.83344];
				var radius=1000;
				center=[data.longitude,data.latitude];
				radius=data.radius;
				document.getElementById("longitude").value=data.longitude;
				document.getElementById("latitude").value=data.latitude;
				document.getElementById("radius").value=data.radius;
				creatMap(center,radius);
			});
		}
	</script>
</html>
